#Imagem ubuntu para criação de container com o necessário para rodar PHP 7.4

FROM ubuntu:latest

LABEL authors="GilbertoJr"

WORKDIR /minhaPasta/projeto

EXPOSE 8000

# Atualizar repositórios e instalar dependências básicas
RUN apt-get update && apt-get install -y \
    software-properties-common \
    ca-certificates \
    lsb-release \
    apt-transport-https \
    curl

# Adicionar repositório PPA do PHP
RUN add-apt-repository ppa:ondrej/php -y

# Atualizar repositórios novamente
RUN apt-get update

# Instalar PHP 7.4 e extensões essenciais
RUN apt-get install -y \
    php7.4 \
    php7.4-cli \
    php7.4-common \
    php7.4-curl \
    php7.4-json \
    php7.4-mbstring \
    php7.4-mysql \
    php7.4-xml \
    php7.4-zip \
    php7.4-gd \
    php7.4-intl \
    php7.4-bcmath \
    php7.4-soap \
    php7.4-xsl \
    php7.4-pdo \
    php7.4-fpm

# Limpar cache do apt
RUN apt-get clean && rm -rf /var/lib/apt/lists/*

#Instalação do Node.js e NPM via NVM
RUN curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash

#Instalação do Composer
RUN php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
RUN php -r "if (hash_file('sha384', 'composer-setup.php') === 'dac665fdc30fdd8ec78b38b9800061b4150413ff2e3b6f88543c636f7cd84f6db9189d43a81e5503cda447da73c7e5b6') { echo 'Installer verified'.PHP_EOL; } else { echo 'Installer corrupt'.PHP_EOL; unlink('composer-setup.php'); exit(1); }"
RUN php composer-setup.php
RUN php -r "unlink('composer-setup.php');"
RUN mv composer.phar /usr/local/bin/composer
